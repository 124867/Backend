<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Upload a Cat</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>Upload a Cat</h1>
    <div id="reg">  
      <h2>Cat info</h2>
      <label>Name</label><br></br>
      <input id="name"><br></br>
      <label>Age</label><br></br>
      <input id="age" type="number"><br></br>
      <label>Breed</label><br></br>
      <input id="breed"><br></br>
      <label>Image</label><br></br>
      <input id="image" type="file"><br></br>
      <button id="regSubmit">Submit</button><br></br>
    </div>
    <div id="catList">
      <h2>All Cats</h2>
      <ul id="catListItems"></ul>
      <button id="listBtn">List Cats</button>
    </div>
    <script>
      // Get references to the form elements
      const regAge = document.querySelector('#age')
      const regName = document.querySelector('#name')
      const regBreed = document.querySelector('#breed')
      const regImg = document.querySelector('#image')
      const regSubmit = document.querySelector('#regSubmit')

      // Get references to the list elements
      const listBtn = document.querySelector('#listBtn');
      const catListItems = document.querySelector('#catListItems');

      // Add an event listener to the submit button
      regSubmit.addEventListener('click', () => {
        // Create a new FormData object and append the form data to it
        const formData = new FormData();
        formData.append('age', regAge.value);
        formData.append('breed', regBreed.value);
        formData.append('name', regName.value);
        formData.append('image', regImg.files[0]);

        // Get the current URL and append the /cats route to it
        const url = window.location.origin + '/cats/upload';

        // Send a POST request to the server with the form data
        fetch(url, {
          method: 'POST',
          body: formData,
        })
          .then((res) => res.json())
          .then((data) => {
            console.log(data);
            location.reload();
          })
          .catch((err) => {
            console.error(err);
          })
      })

      // Add an event listener to the list button
      listBtn.addEventListener('click', () => {
        // Get the current URL and append the /cats route to it
        const url = window.location.origin + '/cats/list';

        // Send a GET request to the server to list all the cats
        fetch(url)
          .then((res) => res.json())
          .then((cats) => {
            // Clear the previous list items
            catListItems.innerHTML = '';

            // Add each cat to the list
            cats.forEach((cat) => {
              const li = document.createElement('li');
              const img = document.createElement('img');
              img.src = cat.image;
              img.alt = cat.name;
              li.appendChild(img);
              li.appendChild(document.createTextNode(`${cat.name}, ${cat.age}, ${cat.breed}`));

              // Add a delete button for each cat
              const deleteBtn = document.createElement('button');
              deleteBtn.innerText = 'Delete';
              deleteBtn.addEventListener('click', () => {
                const deleteUrl = `${window.location.origin}/cats/${cat._id}`;
                fetch(deleteUrl, { method: 'DELETE' })
                  .then(() => {
                    console.log('Cat deleted successfully');
                    location.reload();
                  })
                  .catch((err) => {
                    console.error(err);
                  });
              });
              li.appendChild(deleteBtn);

              // Add an update button for each cat
              const updateBtn = document.createElement('button');
              updateBtn.innerText = 'Update';
              updateBtn.addEventListener('click', () => {
                const newName = prompt("Enter the new name:");
                const newAge = prompt("Enter the new age:");
                const newBreed = prompt("Enter the new breed:");

                // Create a new FormData object and append the updated cat data to it
                const updateData = new FormData();
                updateData.append('name', newName);
                updateData.append('age', newAge);
                updateData.append('breed', newBreed);

                // Get the current URL and append the cat ID to it
                const updateUrl = `${window.location.origin}/cats/${cat._id}`;

                // Send a PUT request to the server with the updated cat data
                fetch(updateUrl, {
                  method: 'PUT',
                  body: updateData,
                })
                  .then((res) => res.json())
                  .then((data) => {
                    console.log(data);
                    location.reload();
                  })
                  .catch((err) => {
                    console.error(err);
                  });
              });
              li.appendChild(updateBtn);

              catListItems.appendChild(li);
            });
          })
          .catch((err) => {
            console.error(err);
          });
      });
    </script>
  </body>
</html>