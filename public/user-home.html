<!DOCTYPE html>
<html>
<head>
	<title>User Home Page</title>
</head>
<body>
	<h1>Welcome to the User Home Page</h1>
	<p>You are logged in as a user.</p>
	<p>Here, you can view and manage your account information, as well as access any features or services that are available to you.</p>
	<p>Thank you for using our application!</p>
  <div id="cat-list"></div>
  <div class="search-filter">
  <label for="search-input">Search:</label>
  <input type="text" id="search-input">
  <label for="filter-input">Filter by age:</label>
  <select id="filter-input">
    <option value="all">All</option>
    <option value="1">1 year</option>
    <option value="2">2 years</option>
    <option value="3">3 years</option>
  </select>
</div>
</body>
  <script>
const catList = document.getElementById('cat-list');

// Fetch the cat list from the server and display it
fetch('/cats/list')
  .then((res) => res.json())
  .then((cats) => {
    // Clear the previous list items
    catList.innerHTML = '';

    // Add each cat to the list
    cats.forEach((cat) => {
      const div = document.createElement('div');
      const img = document.createElement('img');
      img.src = cat.image;
      img.alt = cat.name;
      div.appendChild(img);
      div.appendChild(document.createTextNode(`${cat.name}, ${cat.age}, ${cat.breed}`));
      
      // Add a add to favorites button for each cat
      const favBtn = document.createElement('button');
      favBtn.innerText = 'Add to Favorites';
      favBtn.addEventListener('click', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        if (!token) {
          console.error('Missing auth token');
          return; // or show an error message to the user
        }
        
        const addFavUrl = `/user/favorites/${cat._id}?token=${token}`;
        fetch(addFavUrl, { 
          method: 'PUT',
        })
          .then((res) => {
            if (res.ok) {
              console.log('Cat added to favorites successfully');
            } else {
              throw new Error('Failed to add cat to favorites');
            }
          })
          .catch((err) => {
            console.error(err);
          });
      });
      div.appendChild(favBtn);

      catList.appendChild(div);
    });
  })
  .catch((err) => {
    console.error(err);
  });

    
  // Get the search/filter inputs
const searchInput = document.getElementById('search-input');
const filterInput = document.getElementById('filter-input');

// Add event listeners for the search/filter inputs
searchInput.addEventListener('input', searchCats);
filterInput.addEventListener('change', filterCats);

// Define the searchCats function
function searchCats() {
  const searchValue = searchInput.value.trim().toLowerCase();

  // Loop through all the cats in the list and hide/show them based on the search value
  catList.querySelectorAll('div').forEach(cat => {
    const name = cat.querySelector('img').alt.toLowerCase();

    if (name.includes(searchValue)) {
      cat.style.display = 'block';
    } else {
      cat.style.display = 'none';
    }
  });
}

// Define the filterCats function
function filterCats() {
  const filterValue = filterInput.value;

  // Loop through all the cats in the list and hide/show them based on the filter value
  catList.querySelectorAll('div').forEach(cat => {
    const age = cat.textContent.split(',')[1].trim().split(' ')[0];

    if (filterValue === 'all' || age === filterValue) {
      cat.style.display = 'block';
    } else {
      cat.style.display = 'none';
    }
  });
}
  </script>
</html>